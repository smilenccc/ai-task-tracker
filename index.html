<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - å€‹äººæ•¸æ“šä¸­å¿ƒ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            background: #1a1d23;
            color: #e5e7eb;
            height: 100vh;
            overflow: hidden;
        }

        .layout {
            display: flex;
            height: 100vh;
        }

        /* å´é‚Šæ¬„ */
        .sidebar {
            width: 220px;
            background: #0f1115;
            border-right: 1px solid #2d3138;
            display: flex;
            flex-direction: column;
        }

        .logo {
            padding: 20px;
            font-size: 1.3em;
            font-weight: 700;
            color: #fff;
            border-bottom: 1px solid #2d3138;
        }

        .nav-section {
            padding: 20px 0;
        }

        .nav-section-title {
            padding: 8px 20px;
            font-size: 0.75em;
            text-transform: uppercase;
            color: #6b7280;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .nav-item {
            padding: 10px 20px;
            color: #9ca3af;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-item:hover {
            background: #1a1d23;
            color: #fff;
            border-left: 3px solid #d50c2d;
            padding-left: 17px;
        }

        .nav-item.active {
            background: #1a1d23;
            color: #fff;
            border-left: 3px solid #d50c2d;
            padding-left: 17px;
        }

        /* ä¸»è¦å…§å®¹ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é ‚éƒ¨æ¬„ */
        .topbar {
            height: 60px;
            background: #0f1115;
            border-bottom: 1px solid #2d3138;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
        }

        .topbar-left h1 {
            font-size: 1.5em;
            font-weight: 600;
            color: #fff;
        }

        .topbar-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-online {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .create-btn {
            background: #d50c2d;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .create-btn:hover {
            background: #b00a25;
        }

        /* å…§å®¹å€åŸŸ */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            height: 100%;
        }

        /* åœ°åœ–å€åŸŸ */
        .map-section {
            background: #0f1115;
            border-radius: 8px;
            border: 1px solid #2d3138;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .map-header {
            padding: 20px;
            border-bottom: 1px solid #2d3138;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .map-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #fff;
        }

        #map {
            flex: 1;
            min-height: 600px;
            position: relative;
        }

        /* åœ°åœ–åœ–å±¤æ§åˆ¶å™¨ */
        .layer-control {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #0f1115;
            border: 1px solid #2d3138;
            border-radius: 8px;
            padding: 15px;
            z-index: 1000;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .layer-control-title {
            font-size: 0.9em;
            font-weight: 600;
            color: #fff;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .layer-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            color: #e5e7eb;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .layer-option:hover {
            color: #fff;
        }

        .layer-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #d50c2d;
        }

        .layer-icon {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        .layer-icon.service {
            background: #3b82f6;
        }

        .layer-icon.shopping {
            background: #f59e0b;
            border-top: 3px dashed #f59e0b;
        }

        .layer-icon.package-completed {
            background: #10b981;
        }

        .layer-icon.package-pending {
            background: #f59e0b;
            border-top: 3px dashed #f59e0b;
        }

        /* è³‡æºçµ±è¨ˆ */
        .resources-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-card {
            background: #0f1115;
            border: 1px solid #2d3138;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
        }

        .stat-card:hover {
            border-color: #d50c2d;
        }

        .stat-icon {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #fff;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85em;
            color: #9ca3af;
        }

        /* æœå‹™åˆ—è¡¨ */
        .services-section {
            background: #0f1115;
            border: 1px solid #2d3138;
            border-radius: 8px;
        }

        .services-header {
            padding: 20px;
            border-bottom: 1px solid #2d3138;
        }

        .services-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #fff;
        }

        .services-list {
            padding: 10px;
        }

        .service-item {
            padding: 15px;
            border-bottom: 1px solid #2d3138;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .service-item:hover {
            background: #1a1d23;
        }

        .service-item:last-child {
            border-bottom: none;
        }

        .service-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .service-icon {
            font-size: 1.5em;
        }

        .service-name {
            font-weight: 500;
            color: #fff;
            margin-bottom: 4px;
        }

        .service-desc {
            font-size: 0.85em;
            color: #6b7280;
        }

        .service-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .ip-info {
            background: #0f1115;
            border: 1px solid #2d3138;
            border-radius: 8px;
            padding: 20px;
        }

        .ip-title {
            font-size: 1em;
            font-weight: 600;
            color: #fff;
            margin-bottom: 15px;
        }

        .ip-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #2d3138;
        }

        .ip-item:last-child {
            border-bottom: none;
        }

        .ip-label {
            color: #9ca3af;
            font-size: 0.9em;
        }

        .ip-value {
            color: #fff;
            font-weight: 500;
        }

        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 60px;
            }

            .logo, .nav-section-title {
                display: none;
            }

            .nav-item span {
                display: none;
            }
        }

        /* é˜²ç«ç‰†ç™½åå–®å€å¡Š */
        .firewall-info {
            background: #0f1115;
            border: 1px solid #2d3138;
            border-radius: 8px;
            padding: 20px;
        }

        .firewall-title {
            font-size: 1em;
            font-weight: 600;
            color: #fff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .firewall-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .firewall-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #2d3138;
            font-size: 0.9em;
        }

        .firewall-item:last-child {
            border-bottom: none;
        }

        .firewall-ip {
            font-family: 'Courier New', monospace;
            color: #10b981;
            font-weight: 500;
        }

        .firewall-status {
            color: #6b7280;
            font-size: 0.85em;
        }

        .firewall-loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }

        .firewall-error {
            text-align: center;
            padding: 20px;
            color: #ef4444;
            font-size: 0.85em;
        }


        /* ç¸®å°ç‰ˆçµ±è¨ˆå¡ç‰‡ */
        .stat-card-small {
            background: #0f1115;
            border: 1px solid #2d3138;
            border-radius: 6px;
            padding: 12px 16px;
            min-width: 120px;
            flex-shrink: 0;
            transition: all 0.2s;
            text-align: center;
        }

        .stat-card-small:hover {
            border-color: #d50c2d;
            transform: translateY(-2px);
        }

        .stat-icon-small {
            font-size: 1.2em;
            margin-bottom: 6px;
        }

        .stat-value-small {
            font-size: 1.5em;
            font-weight: 700;
            color: #fff;
            margin-bottom: 4px;
        }

        .stat-label-small {
            font-size: 0.75em;
            color: #9ca3af;
        }

    </style>
</head>
<body>
    <div class="layout">
        <!-- å´é‚Šæ¬„ -->
        <div class="sidebar">
            <div class="logo">ğŸ  æ•¸æ“šä¸­å¿ƒ</div>
            
            <div class="nav-section">
                <div class="nav-section-title">ä¸»è¦</div>
                <a class="nav-item active">
                    <span>ğŸ“Š</span>
                    <span>Dashboard</span>
                </a>
                <a href="tasks.html" class="nav-item">
                    <span>ğŸ“‹</span>
                    <span>ä»»å‹™ç³»çµ±</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">æœå‹™</div>
                <a href="https://coupang-dashboard.onrender.com" class="nav-item" target="_blank">
                    <span>ğŸ›’</span>
                    <span>Coupang</span>
                </a>
                <a href="https://credit-card-dashboard.onrender.com" class="nav-item" target="_blank">
                    <span>ğŸ’³</span>
                    <span>ä¿¡ç”¨å¡</span>
                </a>
                <a href="amazon-tracker/index.html" class="nav-item">
                    <span>ğŸ“¦</span>
                    <span>Amazon åŒ…è£¹</span>
                </a>
            </div>
        </div>

        <!-- ä¸»è¦å…§å®¹ -->
        <div class="main-content">
            <!-- é ‚éƒ¨æ¬„ -->
            <div class="topbar">
                <div class="topbar-left">
                    <h1>Dashboard</h1>
                </div>
                <div class="topbar-right">
                    <span class="status-badge status-online">
                        <span class="status-dot"></span> æ‰€æœ‰ç³»çµ±é‹è¡Œæ­£å¸¸
                    </span>
                    <button class="create-btn" onclick="alert('æ–°åŠŸèƒ½é–‹ç™¼ä¸­...')">+ æ–°å¢æœå‹™</button>
                </div>
            </div>

            <!-- å…§å®¹ -->
            <div class="content">
                <div class="content-grid">
                    <!-- å·¦å´ï¼šåœ°åœ– + çµ±è¨ˆ -->
                    <div style="display: flex; flex-direction: column; gap: 0;">
                        <div class="map-section">
                            <div class="map-header">
                                <div class="map-title">ğŸ—ºï¸ å…¨çƒæœå‹™åˆ†å¸ƒ</div>
                                <div style="display: flex; gap: 20px; font-size: 0.8em; color: #9ca3af;">
                                    <span style="display: flex; align-items: center; gap: 5px;">
                                        <span style="width: 20px; height: 2px; background: #10b981;"></span>
                                        å·²å®Œæˆè·¯å¾‘
                                    </span>
                                    <span style="display: flex; align-items: center; gap: 5px;">
                                        <span style="width: 20px; height: 2px; background: #f59e0b; border-top: 2px dashed #f59e0b;"></span>
                                        é‹é€ä¸­
                                    </span>
                                    <span style="display: flex; align-items: center; gap: 5px;">
                                        <span style="width: 12px; height: 12px; background: #3b82f6; border-radius: 50%;"></span>
                                        åŒ…è£¹ä½ç½®
                                    </span>
                                </div>
                            </div>
                            <div id="map">
                                <div class="layer-control">
                                    <div class="layer-control-title">ğŸ—ºï¸ åœ–å±¤æ§åˆ¶</div>
                                    <label class="layer-option">
                                        <input type="checkbox" class="layer-checkbox" id="toggle-service" checked>
                                        <span class="layer-icon service"></span>
                                        <span>æœå‹™å™¨é€£ç·š</span>
                                    </label>
                                    <label class="layer-option">
                                        <input type="checkbox" class="layer-checkbox" id="toggle-shopping" checked>
                                        <span class="layer-icon shopping"></span>
                                        <span>è³¼ç‰©ç‰©æµ</span>
                                    </label>
                                    <label class="layer-option">
                                        <input type="checkbox" class="layer-checkbox" id="toggle-package-completed" checked>
                                        <span class="layer-icon package-completed"></span>
                                        <span>åŒ…è£¹å·²å®Œæˆè·¯å¾‘</span>
                                    </label>
                                    <label class="layer-option">
                                        <input type="checkbox" class="layer-checkbox" id="toggle-package-pending" checked>
                                        <span class="layer-icon package-pending"></span>
                                        <span>åŒ…è£¹é‹é€ä¸­è·¯å¾‘</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- å³å´ï¼šæœå‹™åˆ—è¡¨ + IP è³‡è¨Š -->
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div class="services-section">
                            <div class="services-header">
                                <div class="services-title">ğŸš€ é‹è¡Œä¸­çš„æœå‹™</div>
                            </div>
                            <div class="services-list">
                                <a href="tasks.html" class="service-item">
                                    <div class="service-info">
                                        <div class="service-icon">ğŸ“‹</div>
                                        <div>
                                            <div class="service-name">AI ä»»å‹™çµ±è¨ˆ</div>
                                            <div class="service-desc">GitHub Pages</div>
                                        </div>
                                    </div>
                                    <div class="service-status">
                                        <span class="status-dot"></span>
                                        <span style="color: #10b981; font-size: 0.85em;">é‹è¡Œä¸­</span>
                                    </div>
                                </a>

                                <a href="https://coupang-dashboard.onrender.com" class="service-item" target="_blank">
                                    <div class="service-info">
                                        <div class="service-icon">ğŸ›’</div>
                                        <div>
                                            <div class="service-name">Coupang åˆ†æ</div>
                                            <div class="service-desc">Render Â· Singapore</div>
                                        </div>
                                    </div>
                                    <div class="service-status">
                                        <span class="status-dot"></span>
                                        <span style="color: #10b981; font-size: 0.85em;">é‹è¡Œä¸­</span>
                                    </div>
                                </a>

                                <a href="https://credit-card-dashboard.onrender.com" class="service-item" target="_blank">
                                    <div class="service-info">
                                        <div class="service-icon">ğŸ’³</div>
                                        <div>
                                            <div class="service-name">ä¿¡ç”¨å¡çµ±è¨ˆ</div>
                                            <div class="service-desc">Render Â· Singapore</div>
                                        </div>
                                    </div>
                                    <div class="service-status">
                                        <span class="status-dot"></span>
                                        <span style="color: #10b981; font-size: 0.85em;">é‹è¡Œä¸­</span>
                                    </div>
                                </a>

                                <a href="amazon-tracker/index.html" class="service-item">
                                    <div class="service-info">
                                        <div class="service-icon">ğŸ“¦</div>
                                        <div>
                                            <div class="service-name">Amazon åŒ…è£¹è¿½è¹¤</div>
                                            <div class="service-desc">ECMS Express Â· é‹é€ä¸­</div>
                                        </div>
                                    </div>
                                    <div class="service-status">
                                        <span class="status-dot" style="background: #3b82f6; animation: pulse 2s infinite;"></span>
                                        <span style="color: #3b82f6; font-size: 0.85em;">å·²ç™¼è²¨</span>
                                    </div>
                                </a>

                                <a href="email-tasks/index.html" class="service-item">
                                    <div class="service-info">
                                        <div class="service-icon">ğŸ“§</div>
                                        <div>
                                            <div class="service-name">éƒµä»¶äº¤è¾¦ä»»å‹™</div>
                                            <div class="service-desc">smilenccc@gmail.com</div>
                                        </div>
                                    </div>
                                    <div class="service-status">
                                        <span class="status-dot"></span>
                                        <span style="color: #10b981; font-size: 0.85em;">é‹è¡Œä¸­</span>
                                    </div>
                                </a>

                                <a href="firewall/index.html" class="service-item">
                                    <div class="service-info">
                                        <div class="service-icon">ğŸ›¡ï¸</div>
                                        <div>
                                            <div class="service-name">é˜²ç«ç‰†ç®¡ç†</div>
                                            <div class="service-desc">ç™½åå–® Â· 2FA èªè­‰</div>
                                        </div>
                                    </div>
                                    <div class="service-status">
                                        <span class="status-dot"></span>
                                        <span style="color: #10b981; font-size: 0.85em;">é‹è¡Œä¸­</span>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <div class="ip-info">
                            <div class="ip-title">ğŸ“¡ é€£ç·šè³‡è¨Š</div>
                            <div class="ip-item">
                                <span class="ip-label">æ‚¨çš„ IP</span>
                                <span class="ip-value" id="userIP">è¼‰å…¥ä¸­...</span>
                            </div>
                            <div class="ip-item">
                                <span class="ip-label">ä½ç½®</span>
                                <span class="ip-value" id="userLocation">è¼‰å…¥ä¸­...</span>
                            </div>
                            <div class="ip-item">
                                <span class="ip-label">ISP</span>
                                <span class="ip-value" id="userISP">è¼‰å…¥ä¸­...</span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–åœ°åœ–
        const map = L.map('map', {
            center: [25.0, 15.0],
            zoom: 2,
            zoomControl: true
        });

        // æ·±è‰²åœ°åœ–ä¸»é¡Œ
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap contributors Â© CARTO',
            maxZoom: 19
        }).addTo(map);

        // å»ºç«‹åœ–å±¤çµ„
        const serviceLinesGroup = L.layerGroup().addTo(map);
        const shoppingLinesGroup = L.layerGroup().addTo(map);
        const packageCompletedGroup = L.layerGroup().addTo(map);
        const packagePendingGroup = L.layerGroup().addTo(map);

        // æœå‹™ä½ç½®æ¨™è¨˜
        const locations = [
            { name: 'GitHub Pages', coords: [37.7749, -122.4194], desc: 'AI ä»»å‹™çµ±è¨ˆ', icon: 'ğŸ“‹', type: 'service' },
            { name: 'Render Singapore', coords: [1.3521, 103.8198], desc: 'Coupang & ä¿¡ç”¨å¡', icon: 'ğŸš€', type: 'service' },
            { name: 'Hetzner Germany', coords: [50.1109, 8.6821], desc: 'OpenClaw Gateway', icon: 'ğŸ–¥ï¸', type: 'service' }
        ];

        // è³¼ç‰©/ç‰©æµä½ç½®ï¼ˆå¾ Coupang ç­‰æ¨æ¸¬ï¼‰
        const shoppingLocations = [
            { name: 'éŸ“åœ‹ Coupang', coords: [37.5665, 126.9780], desc: 'é…·æ¾è³¼ç‰©', icon: 'ğŸ›’', type: 'shopping' },
            { name: 'ä¸­åœ‹ç‰©æµä¸­å¿ƒ', coords: [31.2304, 121.4737], desc: 'å•†å“é…é€', icon: 'ğŸ“¦', type: 'shopping' }
        ];

        // Amazon åŒ…è£¹ç‰©æµè·¯å¾‘
        const amazonPackage = {
            origin: { name: 'Amazon.de å€‰åº«', coords: [50.1109, 8.6821], desc: 'å¾·åœ‹æ³•è˜­å…‹ç¦', icon: 'ğŸ­' },
            transit: { name: 'ECMS ç‰©æµä¸­å¿ƒ', coords: [31.2304, 121.4737], desc: 'å·²åˆ°é”ç‰©æµä¸­å¿ƒ', icon: 'ğŸš›' },
            destination: { name: 'æ”¶ä»¶åœ°å€', coords: [24.0992, 120.6839], desc: 'å°ä¸­å¸‚å¤§é‡Œå€', icon: 'ğŸ ' },
            status: 'dispatched', // dispatched, in_transit, out_for_delivery, delivered
            trackingNumber: 'AXIXPPL001333550',
            orderId: '303-0977485-2042700'
        };

        // ç¹ªè£½æœå‹™å™¨æ¨™è¨˜
        locations.forEach(loc => {
            const marker = L.marker(loc.coords, {
                icon: L.divIcon({
                    html: `<div style="background: #d50c2d; color: white; padding: 8px 12px; border-radius: 4px; font-weight: bold; white-space: nowrap; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">${loc.icon} ${loc.name}</div>`,
                    className: 'custom-marker',
                    iconSize: [120, 40]
                })
            }).addTo(map);
            marker.bindPopup(`<b>${loc.name}</b><br>${loc.desc}`);
        });

        // ç¹ªè£½è³¼ç‰©/ç‰©æµæ¨™è¨˜
        shoppingLocations.forEach(loc => {
            const marker = L.marker(loc.coords, {
                icon: L.divIcon({
                    html: `<div style="background: #f59e0b; color: white; padding: 8px 12px; border-radius: 4px; font-weight: bold; white-space: nowrap; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">${loc.icon} ${loc.name}</div>`,
                    className: 'shopping-marker',
                    iconSize: [120, 40]
                })
            }).addTo(map);
            marker.bindPopup(`<b>${loc.name}</b><br>${loc.desc}`);
        });

        // ç¹ªè£½ Amazon åŒ…è£¹ç‰©æµè·¯å¾‘
        function drawPackageRoute() {
            // èµ·é»ï¼šAmazon å¾·åœ‹å€‰åº«
            const originMarker = L.marker(amazonPackage.origin.coords, {
                icon: L.divIcon({
                    html: `<div style="background: #ff9900; color: white; padding: 8px 12px; border-radius: 4px; font-weight: bold; white-space: nowrap; box-shadow: 0 4px 12px rgba(255,153,0,0.5);">${amazonPackage.origin.icon} ${amazonPackage.origin.name}</div>`,
                    className: 'package-marker',
                    iconSize: [140, 40]
                })
            }).addTo(map);
            originMarker.bindPopup(`<b>${amazonPackage.origin.name}</b><br>${amazonPackage.origin.desc}<br><small>è¨‚å–®: ${amazonPackage.orderId}</small>`);

            // ä¸­è½‰é»ï¼šECMS ç‰©æµä¸­å¿ƒï¼ˆç›®å‰ä½ç½®ï¼‰
            const transitMarker = L.marker(amazonPackage.transit.coords, {
                icon: L.divIcon({
                    html: `<div style="background: #3b82f6; color: white; padding: 10px 14px; border-radius: 4px; font-weight: bold; white-space: nowrap; box-shadow: 0 0 20px rgba(59,130,246,0.8); animation: pulse 2s infinite;">${amazonPackage.transit.icon} ${amazonPackage.transit.name} ğŸ“¦</div>`,
                    className: 'package-current',
                    iconSize: [160, 40]
                })
            }).addTo(map);
            transitMarker.bindPopup(`<b>ğŸ“¦ åŒ…è£¹ç›®å‰ä½ç½®</b><br>${amazonPackage.transit.desc}<br><small>è¿½è¹¤è™Ÿ: ${amazonPackage.trackingNumber}</small><br><small>ç‹€æ…‹: å·²ç™¼è²¨ (Dispatched)</small>`).openPopup();

            // çµ‚é»ï¼šå°ä¸­æ”¶ä»¶åœ°å€
            const destMarker = L.marker(amazonPackage.destination.coords, {
                icon: L.divIcon({
                    html: `<div style="background: #10b981; color: white; padding: 8px 12px; border-radius: 4px; font-weight: bold; white-space: nowrap; box-shadow: 0 4px 12px rgba(16,185,129,0.5);">${amazonPackage.destination.icon} ${amazonPackage.destination.name}</div>`,
                    className: 'package-marker',
                    iconSize: [100, 40]
                })
            }).addTo(map);
            destMarker.bindPopup(`<b>${amazonPackage.destination.name}</b><br>${amazonPackage.destination.desc}<br><small>Smile Huang</small>`);

            // ç¹ªè£½è·¯å¾‘ï¼šå¾·åœ‹ â†’ ç‰©æµä¸­å¿ƒï¼ˆå¯¦ç·šï¼Œå·²å®Œæˆï¼‰
            const completedPath = L.polyline([amazonPackage.origin.coords, amazonPackage.transit.coords], {
                color: '#10b981',
                weight: 3,
                opacity: 0.8,
                dashArray: '0'
            }).addTo(packageCompletedGroup);

            // æ·»åŠ ç®­é ­åˆ°å·²å®Œæˆè·¯å¾‘
            L.polylineDecorator(completedPath, {
                patterns: [
                    {
                        offset: '50%',
                        repeat: 0,
                        symbol: L.Symbol.arrowHead({
                            pixelSize: 12,
                            polygon: false,
                            pathOptions: {
                                stroke: true,
                                weight: 3,
                                color: '#10b981',
                                opacity: 0.8
                            }
                        })
                    }
                ]
            }).addTo(packageCompletedGroup);

            // ç¹ªè£½è·¯å¾‘ï¼šç‰©æµä¸­å¿ƒ â†’ å°ä¸­ï¼ˆè™›ç·šï¼Œé€²è¡Œä¸­ï¼‰
            const pendingPath = L.polyline([amazonPackage.transit.coords, amazonPackage.destination.coords], {
                color: '#f59e0b',
                weight: 3,
                opacity: 0.6,
                dashArray: '10, 10'
            }).addTo(packagePendingGroup);

            // æ·»åŠ ç®­é ­åˆ°é€²è¡Œä¸­è·¯å¾‘
            L.polylineDecorator(pendingPath, {
                patterns: [
                    {
                        offset: '50%',
                        repeat: 0,
                        symbol: L.Symbol.arrowHead({
                            pixelSize: 12,
                            polygon: false,
                            pathOptions: {
                                stroke: true,
                                weight: 3,
                                color: '#f59e0b',
                                opacity: 0.6
                            }
                        })
                    }
                ]
            }).addTo(packagePendingGroup);

            // èª¿æ•´åœ°åœ–è¦–è§’ä»¥é¡¯ç¤ºæ•´å€‹è·¯å¾‘
            const bounds = L.latLngBounds([
                amazonPackage.origin.coords,
                amazonPackage.transit.coords,
                amazonPackage.destination.coords
            ]);
            map.fitBounds(bounds, { padding: [50, 50] });
        }

        // åŸ·è¡Œç¹ªè£½
        drawPackageRoute();

        // ç¹ªè£½å‹•ç•«é€£ç·š
        function drawAnimatedLine(from, to, color, dashArray, weight = 2, layerGroup = null) {
            const line = L.polyline([from, to], {
                color: color,
                weight: weight,
                opacity: 0.6,
                dashArray: dashArray,
                className: 'animated-line'
            });

            // æ·»åŠ ç®­é ­è£é£¾
            const decorator = L.polylineDecorator(line, {
                patterns: [
                    {
                        offset: '50%',
                        repeat: 0,
                        symbol: L.Symbol.arrowHead({
                            pixelSize: 10,
                            polygon: false,
                            pathOptions: {
                                stroke: true,
                                weight: 2,
                                color: color,
                                opacity: 0.6
                            }
                        })
                    }
                ]
            });

            // æ·»åŠ åˆ°æŒ‡å®šåœ–å±¤çµ„æˆ–åœ°åœ–
            if (layerGroup) {
                line.addTo(layerGroup);
                decorator.addTo(layerGroup);
            } else {
                line.addTo(map);
                decorator.addTo(map);
            }

            return { line, decorator };
        }

        // ç²å–ç”¨æˆ¶ IP å’Œä½ç½®
        fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                document.getElementById('userIP').textContent = data.ip;
                document.getElementById('userLocation').textContent = `${data.city}, ${data.country_name}`;
                document.getElementById('userISP').textContent = data.org;

                const userCoords = [data.latitude, data.longitude];

                // åœ¨åœ°åœ–ä¸Šæ¨™è¨˜ç”¨æˆ¶ä½ç½®
                const userMarker = L.marker(userCoords, {
                    icon: L.divIcon({
                        html: `<div style="background: #10b981; color: white; padding: 8px 12px; border-radius: 4px; font-weight: bold; animation: pulse 2s infinite;">ğŸ“ æ‚¨çš„ä½ç½®</div>`,
                        className: 'user-marker',
                        iconSize: [100, 40]
                    })
                }).addTo(map);

                userMarker.bindPopup(`<b>æ‚¨çš„ä½ç½®</b><br>${data.city}, ${data.country_name}`).openPopup();
                
                // ç¹ªè£½åˆ°æœå‹™å™¨çš„é€£ç·šï¼ˆå¯¦ç·šï¼Œä»£è¡¨ç¶²è·¯è«‹æ±‚ï¼‰
                locations.forEach(loc => {
                    drawAnimatedLine(userCoords, loc.coords, '#3b82f6', '5, 10', 2, serviceLinesGroup);
                });

                // ç¹ªè£½åˆ°è³¼ç‰©åœ°é»çš„é€£ç·šï¼ˆè™›ç·šï¼Œä»£è¡¨ç‰©æµï¼‰
                shoppingLocations.forEach(loc => {
                    drawAnimatedLine(userCoords, loc.coords, '#f59e0b', '10, 15', 1.5, shoppingLinesGroup);
                });

                // èª¿æ•´åœ°åœ–è¦–è§’
                map.setView(userCoords, 4);
            })
            .catch(error => {
                console.error('ç²å– IP å¤±æ•—:', error);
                document.getElementById('userIP').textContent = 'ç„¡æ³•å–å¾—';
                document.getElementById('userLocation').textContent = 'ç„¡æ³•å–å¾—';
                document.getElementById('userISP').textContent = 'ç„¡æ³•å–å¾—';
            });

        // è¼‰å…¥ä»»å‹™æ•¸é‡
        fetch('tasks.json')
            .then(response => response.json())
            .then(data => {
                document.getElementById('taskCount').textContent = data.tasks.length;
            })
            .catch(error => console.error('è¼‰å…¥ä»»å‹™å¤±æ•—:', error));

        // åœ–å±¤æ§åˆ¶é–‹é—œ
        document.getElementById('toggle-service').addEventListener('change', function(e) {
            if (e.target.checked) {
                map.addLayer(serviceLinesGroup);
            } else {
                map.removeLayer(serviceLinesGroup);
            }
        });

        document.getElementById('toggle-shopping').addEventListener('change', function(e) {
            if (e.target.checked) {
                map.addLayer(shoppingLinesGroup);
            } else {
                map.removeLayer(shoppingLinesGroup);
            }
        });

        document.getElementById('toggle-package-completed').addEventListener('change', function(e) {
            if (e.target.checked) {
                map.addLayer(packageCompletedGroup);
            } else {
                map.removeLayer(packageCompletedGroup);
            }
        });

        document.getElementById('toggle-package-pending').addEventListener('change', function(e) {
            if (e.target.checked) {
                map.addLayer(packagePendingGroup);
            } else {
                map.removeLayer(packagePendingGroup);
            }
        });

        console.log('ğŸ  Dashboard å·²è¼‰å…¥ - Hetzner é¢¨æ ¼ + åœ–å±¤æ§åˆ¶');

        // è¼‰å…¥é˜²ç«ç‰†ç™½åå–®
        async function loadFirewallWhitelist() {
            const listDiv = document.getElementById('firewallList');
            listDiv.innerHTML = '<div class="firewall-loading">è¼‰å…¥ä¸­...</div>';
            
            try {
                const response = await fetch('http://157.180.126.133:5001/webhook/firewall/whitelist', {
                    headers: {
                        'X-API-Key': 'linda-firewall-webhook-secret-2026'
                    }
                });
                
                const data = await response.json();
                
                if (data.success && data.ips) {
                    if (data.ips.length === 0) {
                        listDiv.innerHTML = '<div class="firewall-status">ç›®å‰æ²’æœ‰ç™½åå–® IP</div>';
                        return;
                    }
                    
                    listDiv.innerHTML = data.ips.map(ip => `
                        <div class="firewall-item">
                            <span class="firewall-ip">${ip}</span>
                            <span class="firewall-status">âœ“ å…è¨±</span>
                        </div>
                    `).join('');
                } else {
                    listDiv.innerHTML = '<div class="firewall-error">è¼‰å…¥å¤±æ•—ï¼š' + (data.error || 'æœªçŸ¥éŒ¯èª¤') + '</div>';
                }
            } catch (error) {
                console.error('è¼‰å…¥é˜²ç«ç‰†ç™½åå–®å¤±æ•—:', error);
                listDiv.innerHTML = '<div class="firewall-error">é€£ç·šéŒ¯èª¤</div>';
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥é˜²ç«ç‰†ç™½åå–®
        loadFirewallWhitelist();

    </script>
</body>
</html>
